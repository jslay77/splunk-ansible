---
# Install the UF (opt splunk should already exist) 
#
#

- name: Ensure splunk is stopped prior to upgrade
  command: "{{ splunk_home }}/bin/splunk stop"
  ignore_errors: True

- name: Checkout Latest Splunk Forwarder from Git
  git: repo={{ uf_git_repo }} dest={{ splunk_home }} accept_hostkey=yes force=yes

- name: Copy web.conf for splunk UF
  copy: src=web.conf dest="{{ splunk_home }}/etc/system/local/web.conf" mode=650

- name: Copy deploymentclient.conf
  template: src=uf_deploymentclient.conf dest="{{ splunk_home }}/etc/system/local/deploymentclient.conf" mode=650

- name: Start splunk uf
  command: "{{ splunk_home }}/bin/splunk start --accept-license --answer-yes"

